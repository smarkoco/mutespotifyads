
# detect ads in spotify, mute when detected, unmute after they are over
function mutespotifyads() {
	while true; do # below line needs to count 1 line matching 'Ad.. or Spotify' && counts output lines from audio driver to verify unmuted
		if [ $(wmctrl -l | egrep -i 'Advertisement|Spotify' | wc -l) == 1 ] && [ $(amixer -D pulse | grep "Playback" | grep "off" | wc -l) == 0 ]
		then
			echo "ad @ " $(date) # prints time of ad start to terminal
			amixer set -D pulse Master toggle -q # toggle audio to muted
		fi
    # below line needs to count 0 lines matching 'Ad.. or Spotify' && needs to count 2 lines to show that audio driver is currently muted
		if [ $(wmctrl -l | egrep -i 'Advertisement|Spotify' | wc -l) == 0 ] && [ $(amixer -D pulse | grep "Playback" | grep "off" | wc -l) == 2 ]
		then
			echo "noad @ " $(date) # prints time of ads ending to terminal
			amixer set -D pulse Master toggle -q # toggle audio to unmuted
		fi
		sleep 1 # only check once a second to limit resource usage
	done
}

# call this f(x) to start tmux session to run mutespotifyads() in the bg
function adfree() {
	tmux new-session -d -s adfree # launch detached tmux session with name 'adfree'
	tmux send-keys 'mutespotifyads' C-m # C-m sends ENTER keystroke
}
